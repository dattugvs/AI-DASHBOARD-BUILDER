# DATABASE TYPE
Use only PostgreSQL syntax. Append quotes for the table name & columns: "<table_Name>" & <tableAlias>."columnName"

# SCHEMA
Table: gsCustomers(gsCustomersID, CompanyName, FirstName, MiddleName, LastName, Email, Street, Street2, City, State, Zipcode, County, International)
Table: tblPlan(PlanID, Name)
Table: tblPlanSubscription(SubscriptionId, Number, PlanID, CustomerID, Status, StartDate, NextBillingAt, RenewalDate, EndDate, IsAutoCollection, CreatedOn, EndAction)
Table: tblPlanSubscriptionBillingTerm(ID, SubscriptionId, BillingStartDate, BillingEndDate, Status, PaymentGatewayStatus, Amount)
Table: tblPlanSubscriptionCancel(ID, SubscriptionId, ToBeCancelled, CancelledDate, Source, Status, ReasonID)
Table: tblPlanSubscriptionCancelreason(CancelReasonID, Name)
Table: tblPlanSubscriptionGift(SubscriptionID, IsGifted, GiftedBy)

# BUSINESS RULES
- Subscription Status can be: Future, InTrial, Active, NonRenew, Expired, Cancelled.
- IsAutoCollection = true means automatic/card payments; otherwise manual (e.g., cash/cheque).
- EndAction defines renewal behavior: Renew Once(1), Auto Renew (2), Expire (3), Until Cancelled (4).
- Cancellation is valid only if tblPlanSubscriptionCancel.Status is 'Initiated' or 'Cancelled'.

# CANCELLATION RULES
When cancellation details are requested or relevant:
- Always return: Cancel Status, Cancel Reason (from CancelReasonID → Name), Source (Initiated By)
- Include Cancel Initiated Date and ToBeCancelled if cancellation is initiated but not yet processed.
- Include Cancelled Date if subscription is already cancelled.
- If cancellation happened via system workflow (e.g., due to payment failure), Source will contain 'ESWF'.

# BILLING RULES
- Plans define billing interval as (BillingPeriod, BillingPeriodUnit) — e.g., (1, month), (4, year).
- Each billing cycle generates a BillingTerm (BillingStartDate → BillingEndDate).
- BillingTerm tracks: Amount, Status, PaymentGatewayStatus.
- A billing term represents a single subscription period.

# PAYMENT FAILURE
- A subscription has failed payment if:
  IsAutoCollection = true AND BillingTerm.Amount > 0 AND BillingTerm.PaymentGatewayStatus <> 'Success'.
- System retries the payment for 2-3 days.
- If still failed, subscription is cancel-initiated by workflow (tblPlanSubscriptionCancel.Source LIKE 'ESWF%').

# GIFTING RULES
- If tblPlanSubscriptionGift.IsGifted = true, the subscription was purchased as a gift.
- Gifter's ID is in tblPlanSubscriptionGift.GiftedBy → maps to gsCustomers.gsCustomersID.
- When gift-related info is requested, return: Gifter ID, Gifter Full Name (FirstName + MiddleName + LastName), Email, Address.

# SEARCH QUERIES – COMMON FIELDS
Always return the following fields in search results, even if not requested:
- Subscription ID, Subscription Number, Subscription Status
- Customer ID, Customer Name (FirstName + MiddleName + LastName)
- Plan ID, Plan Name, IsGifted

# RELATIONSHIPS
- tblPlanSubscription.CustomerID → gsCustomers.gsCustomersID
- tblPlanSubscription.PlanID → tblPlan.PlanID
- tblPlanSubscriptionCancel.SubscriptionId → tblPlanSubscription.SubscriptionId
- tblPlanSubscriptionGift.SubscriptionId → tblPlanSubscription.SubscriptionId
- tblPlanSubscriptionGift.GiftedBy → gsCustomers.gsCustomersID
